-- https://hudsondosantos.com/2014/10/01/script-simples-para-backup-de-todos-os-bancos-de-dados-do-sql-server/
-- https://www.mssqltips.com/sqlservertip/1070/simple-script-to-backup-all-sql-server-databases/
-- https://ola.hallengren.com/sql-server-backup.html

DECLARE @path     VARCHAR(256) -- path for backup files  
DECLARE @name     VARCHAR(256) -- filename for backup
DECLARE @fileName VARCHAR(256) -- filename for backup  
DECLARE @fileDate VARCHAR(20)  -- used for file name
 
--- Especifica o diret√≥rio para o backup dos bancos
    SET @path = 'C:\_Backup_SQL\
 
--- Especifica o formato do arquivo
	SELECT @fileDate = CONVERT(VARCHAR(20),GETDATE(),112) 
 
	DECLARE db_cursor CURSOR FOR

	SELECT name 
	 FROM master.dbo.sysdatabases 
	WHERE name NOT IN ( 'master' , 'model' , 'msdb' , 'tempdb' , 'softmy_mmconsult' )  -- exclude these databases

	OPEN db_cursor   
	FETCH NEXT FROM db_cursor INTO @name   
 
	WHILE @@FETCH_STATUS = 0
	BEGIN   
		   SET @fileName = @path + @name + '_' + @fileDate + '.BAK'
		   BACKUP DATABASE @name TO DISK = @fileName

		   FETCH NEXT FROM db_cursor INTO @name
	END
 
	CLOSE      db_cursor
	DEALLOCATE db_cursor
